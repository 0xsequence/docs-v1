# Session Management

Sequence Auth + WaaS handles the following aspects of your application:

- User creation
- User authentication
- Session management

This means you don't need to implement an account system yourself; instead, you interact with the Auth + WaaS SDK whenever you need to authenticate a user.

## Sign in / Sign Up

Signing in and signing up are the same operation; the account is automatically created if it doesn't already exist.

```ts
import { Sequence } from '@0xsequence/waas'

const waas = new Sequence({
  projectAccessKey: `${process.env.PROJECT_ACCESS_KEY}`,
  waasConfigKey: `${process.env.WAAS_CONFIG_KEY}`,
  network: 'mumbai'
}, defaults.TEST)

// Get an idToken using the social auth provider of your choice
// (e.g., Google, Facebook, Twitter, etc.)
const res = await waas.signIn({ idToken }, "MacBook Pro - Chrome")

console.log(res)
```

```json
{
  "sessionId": "0x63A21cCa14ed7454B9cF6466af422B5c597c6b57",
  "wallet": "0xd6043fe6f06d90ec2cB36cA5CD1B193A8515f350",
}
```

:::warning **Session ID**
Even though the `sessionId` looks like an Ethereum address, it is not. It is a unique identifier for the session and must never be used as a recipient of funds. Any funds sent to a `sessionId` will be lost forever.
:::

:::note
Sessions opened with some providers might require a second step in order to be usable for sending transactions.

See [Email validation](/waas/waas-auth/validation).
:::

### Email Sign In / Sign Up

Email sign-in is directly supported by the SDK, as long as the used `key` has been generated with the `email` scope. Email logins work similarly to social logins, except that the `idToken` is generated by the SDK itself.

To open a session using an email, you will need to provide an email for the user. The WaaS Nitro API will then send an email to the user with a One-Time Password (OTP) that can be used to open a session. This OTP has to be provided to the SDK to obtain an `idToken`.

Once the `idToken` is obtained, the session can be opened as usual.

```ts
import { Sequence } from '@0xsequence/waas'

// Define the user's email address
const email = "user@example.com"

const waas = new Sequence({
  projectAccessKey: `${process.env.PROJECT_ACCESS_KEY}`,
  waasConfigKey: `${process.env.WAAS_CONFIG_KEY}`,
  network: 'mumbai'
}, defaults.TEST)

// This will send an email to the user with an OTP
const { instance } = await waas.email.initiateAuth({ email })

// Obtain the OTP from the user
const answer = "123456"

const { idToken } = await waas.email.finalizeAuth({ instance, answer, email })

// Log in using the idToken, as usual
await waas.signIn({ idToken }, "Apple Vision Pro - Chrome")
```

### Phone Sign In / Sign Up

Phone sign-in is still in development. Stay tuned!
Contact us if you need this feature.

## List Sessions

This function returns a list of sessions for the current user and only includes sessions that are still valid.

```ts
import { Sequence } from '@0xsequence/waas'

const waas = new Sequence({
  projectAccessKey: `${process.env.PROJECT_ACCESS_KEY}`,
  waasConfigKey: `${process.env.WAAS_CONFIG_KEY}`,
  network: 'mumbai'
}, defaults.TEST)

await waas.signIn({ idToken }, "MacBook Pro - Chrome")

const sessions = await waas.listSessions()
console.log(sessions)
```

```json
[
  {
    "id": "0x574372ff1A0Eede68B5358Cce7bbb93155A9dfe0",
    "address": "0x574372ff1a0eede68b5358cce7bbb93155a9dfe0",
    "userId": "42#https://accounts.google.com#109234880945084120673",
    "projectId": 42,
    "issuer": "https://accounts.google.com",
    "subject": "109234880945084120673",
    "friendlyName": "Pixel 3 - Brave",
    "createdAt": "2023-11-02T18:22:03.102950917Z",
    "refreshedAt": "2023-11-02T18:22:03.109787921Z",
    "expiresAt": "2123-10-09T18:22:03.102951017Z",
    "isThis": false
  },
  {
    "id": "0x3C4E11E4dbF23B87C14bd75d0Da9C75707392D21",
    "address": "0x3c4e11e4dbf23b87c14bd75d0da9c75707392d21",
    "userId": "42#https://accounts.google.com#109234880945084120673",
    "projectId": 42,
    "issuer": "https://accounts.google.com",
    "subject": "109234880945084120673",
    "friendlyName": "MacBook Pro - Chrome",
    "createdAt": "2023-11-02T18:50:32.815189174Z",
    "refreshedAt": "2023-11-02T18:50:32.819722082Z",
    "expiresAt": "2123-10-09T18:50:32.815189234Z",
    "isThis": true
  }
]
```

## Close Session

A session can be closed using the `id` of the session. Any session can be closed from any device with an active session.

```ts
import { Sequence } from '@0xsequence/waas'

const waas = new Sequence({
  projectAccessKey: `${process.env.PROJECT_ACCESS_KEY}`,
  waasConfigKey: `${process.env.WAAS_CONFIG_KEY}`,
  network: 'mumbai'
}, defaults.TEST)

await waas.signIn({ idToken }, "MacBook Pro - Chrome")

const sessions = await waas.listSessions()
await waas.dropSession({ sessionId: sessions[0].id })
```
