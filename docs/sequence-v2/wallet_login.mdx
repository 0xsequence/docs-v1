---
sidebar_position: 3
---

# Wallet Login

This protocol describes the login flow for Sequence v2 wallets:

### 1 - Unique Recoverable Private Key

The wallet client prompts the user to generate or input a unique recoverable private key (currently Torus); an address is derived from this key and is referred to as the "recovery address".

### 2 - Wallet lookup

The wallet clients use the following mediums to discover all wallets that may contain this address between the signers:

- The Sequence v1 RequireUtils contract.
- All available APIs.
- All available information on the local IndexedDB.

The wallet client must filter out all wallets that the recovery address has not explicitly approved. The recovery address may approve a wallet by:

- Providing a signature of the configuration payload.
- Have a RequiredSigner event emitted by the RequireUtils contract.

This step is critical to filter out any wallets generated by a third party that may interfere with the ability of the user to find their correct wallet.

:::info No Addresses found

If no wallets are found, the client must offer the user the options to (a) upload a recovery file or (b) create a new wallet. The option (b) redirects to the Wallet Creation flow.

:::

### 3 - Address identification

The wallet client must prompt the user with a selection of all found wallets. The selection screen must display the wallet address, the generative wallet image, and the highest value asset held by each wallet (with its corresponding balance).

This screen should contain a "My wallet is not here" option; this option should allow the user to input either a recovery QR or a recovery file as an alternative means to recover the wallet.

### 4 - Retrieve latest configuration

After the user selects a wallet address, the wallet client should use all available data sources to retrieve all known pre-signed configuration update transactions. These pre-signed transactions will define the counterfactual wallet state and thus define the latest configuration on which the new session should be applied.

The wallet client must store all known pre-signed transactions for this wallet on the browser LocalStore; this information should persist across logins.

### 5 - Latest session confirmation

Using the latest wallet configuration, the wallet client should prompt the user to ask:

```
Was <prev device> at <last login date> your last login?
```

This window should include the following information:

1. Name of the last device
2. Last time and date of the login
3. Detailed view with all known sessions

If the user finds missing sessions or information, it must be prompted with uploading a recovery file or QR. This step is repeated until the user accepts this information as correct.

### 6 - Generate wallet update and pre-sign transaction

The wallet client must generate a new Session key, and it should generate an update config transaction that adds the generated key to the last known configuration of the wallet.

The generated transaction must use a random nonce to bypass the enforced native transaction ordering of Sequence.

The generated transaction bundle must include a call to a NonceGap contract; this contract would enforce a sequence-like nonce for transactions but allow gaps between nonces.

This system allows the user to determine the current configuration without forcing them to publish all of them to the blockchain when sending a transaction.

The generated transaction should be signed with enough signers to be valid when using the last known configuration of the wallet.

This process must be repeated for all known networks.

### 7 - Publish pre-signed transaction

The wallet client must send all the pre-signed transactions to all available APIs and prompt the user to manually store them (QR picture, screenshot, copy-paste, download file, etc.).

:::caution Pre-signed transaction persistence

If none of those processes succeed, the opening of the session must be canceled.

:::

## Complete signup & login flow

[![Sequence v2 - Login Flow](/img/v2/login-flow.svg)](/img/v2/login-flow.svg) 
[Expand](/img/v2/login-flow.svg) 
